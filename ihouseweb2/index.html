<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Myhouse</title>
	<link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900" rel="stylesheet" />
	<link href="default.css" rel="stylesheet" type="text/css" media="all" />
	<script src="https://www.oxxostudio.tw/js/lib/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
	<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-app.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-analytics.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-firestore.js"></script>

	<script>
		// Your web app's Firebase configuration
		var firebaseConfig = {
			apiKey: "AIzaSyANb_liFPd2Eysd324y8jlUw_WPFfbPf2A",
			authDomain: "myhouse-59ddd.firebaseapp.com",
			databaseURL: "https://myhouse-59ddd.firebaseio.com",
			projectId: "myhouse-59ddd",
			storageBucket: "myhouse-59ddd.appspot.com",
			messagingSenderId: "90168120796",
			appId: "1:90168120796:web:960c0a79427721038eeb19",
			measurementId: "G-SH95M8H1YJ"
		};
		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		firebase.analytics();

		var db = firebase.firestore();

		function updateData(doc, value) {
			var ref = db.collection('iHouse').doc(doc);

			ref.update(value).then(() => {
				console.log('update data successful');
			});
		}

		getData();

		function getData() {
			var ref = db.collection('iHouse');
			let num = 0;
			ref.get().then(querySnapshot => {
				querySnapshot.forEach(doc => {
					console.log(doc.data());
					switch (num) {
						case 0:
							doorOpen = doc.data().onoff;
							changeDoor();
							break;
						case 1:
							ledOpengreen = doc.data().green;
							ledOpenred = doc.data().red;
							changeRedLed();
							changeGreenLed();
							break;
						case 2:
							document.getElementById('red').value = doc.data().red;
							document.getElementById('green').value = doc.data().green;
							document.getElementById('blue').value = doc.data().blue;
							break;
						case 3:
							document.getElementById('Options').value = doc.data().Options;

							break;
						case 4:
							break;
					}
					num++;


				});

			});

		}
	</script>
</head>

<body>
	<div id="header-wrapper">
		<div id="header" class="container">
			<div id="logo">
				<h1><strong>Myhouse</strong></h1>
			</div>
		</div>
	</div>
	<div id="page" class="container">
		<div id="content">
			<div>
				<img alt="關門" src="./images/closedoor.png" id="door" onclick="changeDoor()" />
			</div>
			<div class="rgb">
				紅色：<input type="range" class="range" id="red" name="action" min="120" max="129" value="50"><br>
				綠色：<input type="range" class="range" id="green" name="action" min="130" max="139" value="130"><br>
				藍色：<input type="range" class="range" id="blue" name="action" min="140" max="149" value="140">
			</div>
			<img alt="開燈" src="./images/openlight.png" id="light" width="60px" onclick="changelight()" /><br>
			<img alt="人體感應器" src="./images/people_induction.png" id="people_induction" />

			<!-- <div class="title">
				<h2>Welcome to Myhouse</h2>
			</div> -->
			<!-- <div class="image image-full">
				<img id="ledImage" src="http://120.125.80.113/jpyuImages/image_52a.gif" width="230px"
					style="float: left;" onclick="changeRedLed()" />
				<img id="ledImage2" src="http://120.125.80.113/jpyuImages/image_53a.gif" width="230px"
					style="float: right;" onclick="changeGreenLed()" />
			</div> -->
			<!-- <img src="images/pic01.jpg" class="image image-full" alt="" /> -->
			<p></p>
		</div>
		<div id="sidebar">
			<div id="stwo-col">
				<div class="sbox1">
					<img alt="燈環" src="./images/ring_original.png" id="ring" onclick="changering()" />
					<img alt="電風扇" src="./images/fan.png" id="fan" onclick="changefan()" />
					<!-- <div class="sbox">
						紅色：<input type="range" class="range" id="red" name="action" min="120" max="129" value="50"><br>
						綠色：<input type="range" class="range" id="green" name="action" min="130" max="139"
							value="130"><br>
						藍色：<input type="range" class="range" id="blue" name="action" min="140" max="149"
							value="140"><br>
					</div> -->
					<!-- <select id="Options">
						<option value="150">關閉 LED</option>
						<option value="151">漸變循環</option>
						<option value="152">劇院追逐</option>
						<option value="153">劇院追逐-彩虹色</option>
						<option value="154">彩虹</option>
						<option value="155">彩虹圓圈</option>
						<option value="156">閃光</option>
						<option value="157">流光</option>
						<option value="158">賽隆人</option>
						<option value="159">發泡</option>
					</select>
					<button name="action" class="btn btn-primary" type="submit" value="160">燈條發亮</button><br>
				</div>
				<div class="sbox2">
					<img alt="關門" src="./images/closedoor.png" height=400px id="door"
						onclick="changeDoor()" />
				</div> -->
					<!-- <div id="common_box">
					<div id="cli_on">+</div>
					<div>
						<div class="sbox">
								<select id="Options">
									<option value="150">關閉 LED</option>
									<option value="151">漸變循環</option>
									<option value="152">劇院追逐</option>
									<option value="153">劇院追逐-彩虹色</option>
									<option value="154">彩虹</option>
									<option value="155">彩虹圓圈</option>
									<option value="156">閃光</option>
									<option value="157">流光</option>
									<option value="158">賽隆人</option>
									<option value="159">發泡</option>
								</select>
								<button name="action" class="btn btn-primary" type="submit" value="160">燈條發亮</button><br>
							</div>
						</div> -->
				</div>
			</div>
		</div>
	</div>
	</div>
	<div id="bottom">
	</div>
	<script>
		let doorOpen = false;
		let ledOpenred = false;
		let ledOpengreen = false;
		let fanOpen = false;
		let lightOpen = true;
		let lightStrip = false;
		var r_color = 0;
		var g_color = 0;
		var b_color = 0;
		$('input, select').change(function (event) {
			// event.preventDefault();
			console.log("yo");
			let action = event.target;
			let category = '';
			let num = Math.floor(Number(action.value) / 10);
			console.log(Number(action.value) / 10);
			let value;
			if (num == 12) {
				value = {
					red: Number(action.value)
				};
				category = 'light';
			}
			if (num == 13) {
				value = {
					green: Number(action.value)
				};
				category = 'light';
			}
			if (num == 14) {
				value = {
					blue: Number(action.value)
				};
				category = 'light';
			}
			if (num == 15) {
				value = {
					Options: Number(action.value)
				}
				category = 'lightRing';
			}
			updateData(category, value);
			send(action.value);

		});

		$('button').click(function (event) {
			// event.preventDefault();
			lightStrip = !lightStrip;
			let action = event.target
			updateData('lightStrip', {
				onoff: lightStrip
			});

			send(action.value);
		});

		$('#door').click(function (event) {
			// event.preventDefault();
			let value = !doorOpen ? '111' : '110';
			send(value);
		});

		function send(value) {
			$.get(
				'/action/', {
					'action': value
				},
				function (data) {

				}
			);
		}
		// function janniefish(event) {
		//     // event.preventDefault();
		//     let action = event.target
		//     $.get(
		//         '/action/',
		//         { 'action':  action.value},
		//         function(data) {

		//         }
		//     );
		// }

		function changeDoor() {
			console.log(document.getElementById("door").src);
			// var value;
			if (!doorOpen) {
				document.getElementById("door").src = "./images/opendoor.png";
				// value="110";
			} else {
				document.getElementById("door").src = "./images/closedoor.png";
				// value="111";
			}
			//  return value;
			updateData('door', {
				onoff: Boolean(doorOpen)
			});

			doorOpen = !doorOpen;

		}

		function changefan() {
			console.log(document.getElementById("fan").src);
			if (!fanOpen) {
				document.getElementById("fan").src = "./images/fan1.gif";
			} else {
				document.getElementById("fan").src = "./images/fan.png";
			}
			//  return value

			fanOpen = !fanOpen;

		}

		function changelight() {
			console.log(document.getElementById("light").src);
			// var value;
			if (!lightOpen) {
				document.getElementById("light").src = "./images/openlight.png";
				document.getElementById("page").style.backgroundImage = "url('./images/housebg.jpg')";
			} else {
				document.getElementById("light").src = "./images/closelight.png";
				document.getElementById("page").style.backgroundImage = "url('./images/house_black.png')";
			}
			lightOpen = !lightOpen;

		}

		// function changeRedLed() {
		// 	if (!ledOpenred) {
		// 		document.getElementById("ledImage").src = "http://120.125.80.113/jpyuImages/image_52ared.gif";
		// 	} else {
		// 		document.getElementById("ledImage").src = "http://120.125.80.113/jpyuImages/image_52a.gif";
		// 	}
		// 	updateData('led', {
		// 		red: Boolean(ledOpenred)
		// 	});

		// 	ledOpenred = !ledOpenred;

		// }

		// function changeGreenLed() {
		// 	if (!ledOpengreen) {
		// 		document.getElementById("ledImage2").src = "http://120.125.80.113/jpyuImages/image_53agreen.gif";
		// 	} else {
		// 		document.getElementById("ledImage2").src = "http://120.125.80.113/jpyuImages/image_53a.gif";
		// 	}
		// 	updateData('led', {
		// 		green: Boolean(ledOpengreen)
		// 	});

		// 	ledOpengreen = !ledOpengreen;

		// }
		// let form = document.getElementById("myform");
		// form.addEventListener("submit", janniefish);
		$(function () {
			var r = $('#red');
			r.on('mouseenter', function () {
				var p = (r.val() - 120) * 10 + 5;
				r_color = ((r.val()%100)%10)*(255/9);
				r.on('click', function () {
					p = (r.val() - 120) * 10 + 5;
					r_color = ((r.val()%100)%10)*(255/9);
					console.log("val=" + p);
					bg(p);
				});
				r.on('mousemove', function () {
					p = (r.val() - 120) * 10 + 5;
					r_color = ((r.val()%100)%10)*(255/9);
					bg(p);
				});
			});

			function bg(n) {
				r.css({
					'background-image': '-webkit-linear-gradient(left ,#f22 0%,#f22 ' + n + '%,#fff ' + n +
						'%, #fff 100%)'
				});
				changergb();
			}
		});
		$(function () {
			var g = $('#green');
			g.on('mouseenter', function () {
				var p = (g.val() - 130) * 10 + 5;
				g_color = ((g.val()%100)%10)*(255/9);
				g.on('click', function () {
					p = (g.val() - 130) * 10 + 5;
					g_color = ((g.val()%100)%10)*(255/9);
					console.log("val=" + p);
					bg(p);
				});
				g.on('mousemove', function () {
					p = (g.val() - 130) * 10 + 5;
					g_color = ((g.val()%100)%10)*(255/9);
					bg(p);
				});
			});

			function bg(n) {
				g.css({
					'background-image': '-webkit-linear-gradient(left ,rgb(34, 255, 170) 0%,rgb(34, 255, 170) ' +
						n + '%,#fff ' + n + '%, #fff 100%)'
				});
				changergb();
			}
		});
		$(function () {
			var b = $('#blue');
			b.on('mouseenter', function () {
				var p = (b.val() - 140) * 10 + 5;
				b_color = ((b.val()%100)%10)*(255/9);
				b.on('click', function () {
					p = (b.val() - 140) * 10 + 5;
					b_color = ((b.val()%100)%10)*(255/9);
					console.log("val=" + p);
					bg(p);
				});
				b.on('mousemove', function () {
					p = (b.val() - 140) * 10 + 5;
					b_color = ((b.val()%100)%10)*(255/9);
					bg(p);
				});
			});

			function bg(n) {
				b.css({
					'background-image': '-webkit-linear-gradient(left ,rgb(34, 86, 255) 0%,rgb(34, 86, 255) ' +
						n + '%,#fff ' + n + '%, #fff 100%)'
				});
				changergb();
			}
		});

		function changergb() {
			if (r_color == 0 && g_color == 0 && b_color == 0) {
				document.getElementById('page').style.borderTop = "20px solid #32251B";
			} else {
				document.getElementById('page').style.borderTop = "20px solid rgb(" + r_color + "," + g_color +
					"," + b_color + ")";
			}
			console.log("r:"+r_color);
			console.log("g:"+g_color);
			console.log("b:"+b_color);
		}

		// window.onload = function () {
		// 	var combox = document.getElementById("common_box");
		// 	var cli_on = document.getElementById("cli_on");
		// 	var flag = true,
		// 		timer = null,
		// 		initime = null,
		// 		r_len = 0;
		// 	cli_on.onclick = function () {
		// 		/*
		// 		combox.style.right = flag?'-270px':0;
		// 		flag = !flag;
		// 		*/
		// 		clearTimeout(initime);
		// 		if (flag) {
		// 			r_len = 0;
		// 			timer = setInterval(slideright, 10);
		// 		} else {
		// 			r_len = -270;
		// 			timer = setInterval(slideleft, 10);
		// 		}
		// 	}
		// 	//展開
		// 	function slideright() {
		// 		if (r_len <= -270) {
		// 			clearInterval(timer);
		// 			flag = !flag;
		// 			return false;
		// 		} else {
		// 			r_len -= 5;
		// 			combox.style.right = r_len + 'px';
		// 		}
		// 	}
		// 	//收縮
		// 	function slideleft() {
		// 		if (r_len >= 0) {
		// 			clearInterval(timer);
		// 			flag = !flag;
		// 			return false;
		// 		} else {
		// 			r_len += 5;
		// 			combox.style.right = r_len + 'px';
		// 		}
		// 	}
		// 	//自動收縮
		// 	initime = setTimeout("cli_on.click()", 1000);
		// }
	</script>
</body>

</html>